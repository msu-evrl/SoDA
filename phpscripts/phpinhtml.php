<!DOCTYPE html>
<html>
  <head>
    <link type='text/css' rel='stylesheet' href='style.css'/>
    <title>Data Mining!</title>
  </head>
  <body>
    <img src="http://previews.123rf.com/images/mindscanner/mindscanner1404/mindscanner140401229/27805327-Word-Cloud-with-Data-Mining-related-tags-Stock-Photo.jpg" alt= 'Data Mining'/>
    <div class="header"><h1>
      <?php
      $welcome = "Welcome to the raw feed of twitter Data";
      echo $welcome;
      ?>
    </h1></div>
    <?php
		error_reporting(0);
		class ctwitter_stream
		{
			private $m_oauth_consumer_key;
			private $m_oauth_consumer_secret;
			private $m_oauth_token;
			private $m_oauth_token_secret;

			private $m_oauth_nonce;
			private $m_oauth_signature;
			private $m_oauth_signature_method = 'HMAC-SHA1';
			private $m_oauth_timestamp;
			private $m_oauth_version = '1.0';

			public function __construct()
			{
				//
				// set a time limit to unlimited
				//
				set_time_limit(0);
			}

			//
			// set the login details
			//
			public function login($_consumer_key, $_consumer_secret, $_token, $_token_secret)
			{
				$this->m_oauth_consumer_key     = $_consumer_key;
				$this->m_oauth_consumer_secret  = $_consumer_secret;
				$this->m_oauth_token            = $_token;
				$this->m_oauth_token_secret     = $_token_secret;

				//
				// generate a nonce; we're just using a random md5() hash here.
				//
				$this->m_oauth_nonce = md5(mt_rand());

				return true;
			}

			//
			// process a tweet object from the stream
			//
			
			//
			// the main stream manager
			//
			public function start(array $_keywords)
			{
				while(1)
				{					
					$fp = fsockopen("ssl://stream.twitter.com", 443, $errno, $errstr, 30);
					if (!$fp)
					{
						echo "ERROR: Twitter Stream Error: failed to open socket";
					} 
					else
					{
						//
						// build the data and store it so we can get a length
						//
						$data = 'track=' . rawurlencode(implode($_keywords, ','));

						//
						// store the current timestamp
						//
						$this->m_oauth_timestamp = time();

						//
						// generate the base string based on all the data
						//
						$base_string = 'POST&' . 
							rawurlencode('https://stream.twitter.com/1.1/statuses/filter.json') . '&' .
							rawurlencode('oauth_consumer_key=' . $this->m_oauth_consumer_key . '&' .
								'oauth_nonce=' . $this->m_oauth_nonce . '&' .
								'oauth_signature_method=' . $this->m_oauth_signature_method . '&' . 
								'oauth_timestamp=' . $this->m_oauth_timestamp . '&' .
								'oauth_token=' . $this->m_oauth_token . '&' .
								'oauth_version=' . $this->m_oauth_version . '&' .
								$data);

						//
						// generate the secret key to use to hash
						//
						$secret = rawurlencode($this->m_oauth_consumer_secret) . '&' . 
							rawurlencode($this->m_oauth_token_secret);

						//
						// generate the signature using HMAC-SHA1
						//
						// hash_hmac() requires PHP >= 5.1.2 or PECL hash >= 1.1
						//
						$raw_hash = hash_hmac('sha1', $base_string, $secret, true);

						//
						// base64 then urlencode the raw hash
						//
						$this->m_oauth_signature = rawurlencode(base64_encode($raw_hash));

						//
						// build the OAuth Authorization header
						//
						$oauth = 'OAuth oauth_consumer_key="' . $this->m_oauth_consumer_key . '", ' .
								'oauth_nonce="' . $this->m_oauth_nonce . '", ' .
								'oauth_signature="' . $this->m_oauth_signature . '", ' .
								'oauth_signature_method="' . $this->m_oauth_signature_method . '", ' .
								'oauth_timestamp="' . $this->m_oauth_timestamp . '", ' .
								'oauth_token="' . $this->m_oauth_token . '", ' .
								'oauth_version="' . $this->m_oauth_version . '"';

						//
						// build the request
						//
						$request  = "POST /1.1/statuses/filter.json HTTP/1.1\r\n";
						$request .= "Host: stream.twitter.com\r\n";
						$request .= "Authorization: " . $oauth . "\r\n";
						$request .= "Content-Length: " . strlen($data) . "\r\n";
						$request .= "Content-Type: application/x-www-form-urlencoded\r\n\r\n";
						$request .= $data;

						//
						// write the request
						//
						fwrite($fp, $request);

						//
						// set it to non-blocking
						//
						stream_set_blocking($fp, 0);

						while(!feof($fp))
						{
							$read   = array($fp);
							$write  = null;
							$except = null;

							//
							// select, waiting up to 10 minutes for a tweet; if we don't get one, then
							// then reconnect, because it's possible something went wrong.
							//
							$res = stream_select($read, $write, $except, 600, 0);
							                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             if ( ($res == false) || ($res == 0) )
							{
								break;
							}
							//
							// read the JSON object from the socket
							//
							$json = fgets($fp);

							//
							// look for a HTTP response code
							//
							if (strncmp($json, 'HTTP/1.1', 8) == 0)
							{
								$json = trim($json);
								if ($json != 'HTTP/1.1 200 OK')
								{
									echo 'ERROR: ' . $json . "\n";
									return false;
								}
							}

							//
							// if there is some data, then process it
							//
							if ( ($json !== false) && (strlen($json) > 0) )
							{
								//
								// decode the socket to a associative PHP array
								//
								$data = json_decode($json);
								
								if ($data)
								{
									//
									// process it
									//
									$this->process_tweet($data);
								}
							}
						}
					}

					fclose($fp);
					sleep(10);
				}

				return;
			}
			private function process_tweet($_data)
			{
				static $checker = 0;
				
				//$myfile = fopen("newfile.txt", "w") or die("Unable to open file!");
				//$txt = "John Doe\n";
				//fwrite($myfile, $txt);
				//$txt = "Jane Doe\n";
				//fwrite($myfile, $txt);
				//fclose($myfile);
				//$retweet_count = (string) $_data->retweeted_status->retweet_count;
				print_r($_data);
				echo "<br>";
				echo "<br>";
				/*$s = $_data->created_at;
				$si = "Mon Mar 14 21:33:47 +0000 2016";
				$formatted_date = date('Y-m-d H:i:s', strtotime($s));
				$newdate = new DateTime( $s );
				$newtime = $newdate->format('Y-m-d H:i:s');
				print_r ("Time: ".$formatted_date);
				print ("RawTime: ". $s);
				print_r("Newtime: ".$newtime."<br>");*/
				
				fclose($fl);
				return true;
				
			}

		};
		
		$t = new ctwitter_stream();
		$t->login('Y5bv4r7Ob6sYOVA6EQ9xpHMxX', '81x3J1RMwop6TC8NgMWAxAqLswDoUoACgkJ40AKyTy8GumqCuj', '4634465892-n2vEUdUZsuoHweFwJbJ6075ZFc9I7MUd3tyDZCu', 'Kxaz2EKBJQAOu62y6nPrufXCtS9lDCiAHjGFpoOaUIm5j');
		$t->start(array('BaltimorePolice','BaltimoreSAO','MarilynMosbyEsq','CommishDavis','NicoleSMonroe','TJSmithMedia','FOP3', 'periscopeco', 'MDSP', 'MayorSRB'));

	?>
  </body>
</html>